(window.LVWebpackJsonp=window.LVWebpackJsonp||[]).push([[27],{1044:function(e,t,n){"use strict";n.r(t);n(2);var r=n(85),o=n(8),l=n(5),c=n(38),m=n(4),d=n(43),h=n(1781),_=n(237),f={components:{Modal:d.default,NewsletterForm:h.a,KisaContainer:()=>n.e(34).then(n.bind(null,3936))},props:{modalId:{type:String,default:"newslettersubscription"}},setup(){const{isEnabled:e}=Object(_.a)();return{smsConsentEnabled:e("smsConsentEnabled")}},data:()=>({modalTrigger:null,isModalOpen:!1,isKisaConfirmed:!1,kisaErrorMessage:null,isPending:!1,isOpenQubitModal:!1,schemaSubscribe:null}),computed:{isUserLogged(){return this.$store.state.userContext.userIsLogged},currentType(){return this.$store.state.pageContext.utagData.pageType},hasKisaPreferences(){return this.$store.getters[c.USER_CONTEXT_HAS_KISA_PREFERENCES]},hasSchema(){return this.schemaSubscribe&&!!this.schemaSubscribe.properties},isChina(){return this.$store.getters[m.LOCALE_CONTEXT_IS_CHINA]}},watch:{isModalOpen(e){e&&this.loadNewsletterSchema()}},mounted(){this.userIsLogged||this.registerModal(),this.exposeQubitMethods()},destroyed(){this.$lvModalUnregister({modalId:this.modalId})},methods:{exposeQubitMethods(){window.LV=window.LV||{},window.LV.openNewsletterPanel=e=>{let{isTrackingPopUp:t=!1}=e;this.isModalOpen=!0,this.isOpenQubitModal=t}},async loadNewsletterSchema(){try{if(this.schemaSubscribe)return;const e=this.smsConsentEnabled?r.a.NewsletterSubscribeSms:r.a.NewsletterSubscribe;this.schemaSubscribe=await this.$domain.core.getFormSchema({formName:e})}catch(e){this.$logger.error("Newsletter Side Panel - Loading form schema",e)}},registerModal(){this.$lvModalRegister({modalId:this.modalId,links:[this.modalId],callback:this.handleModal})},handleModal(e,t){if(this.isUserLogged){const e=this.localePath(o.b.MyLvProfile),t=this.isChina?Object(l.e)(e,{legacyUrl:this.$config.legacy_secure_domain_cn}):e;this.$router.push(t)}else this.modalTrigger=e,this.$emit("modal-triggered",t),this.isModalOpen=!0,this.$lvTrackingSendEvent(this.$lvTrackingGenerateData({pageName:this.$store.state.pageContext.utagData.pageName,pageType:this.currentType,categoryGa:"form_newsletter",actionGa:"popin_newsletter_form",actionId:"popin_newsletter_form",position:"popin_newsletter",actionType:"popin"}))},closeModal(){this.$emit("close-modal"),this.isModalOpen=!1,this.isOpenQubitModal&&this.$lvTrackingSendEvent(this.$lvTrackingGenerateData({categoryGa:"form_newsletter",actionGa:"qubit_close_newsletter_modal",actionId:"qubit_close_newsletter_modal",actionType:"close"})),this.isOpenQubitModal=!1},async submitKisa(data){this.isPending=!0;try{await this.$domain.account.updateKisa(data),this.isKisaConfirmed=!0}catch({error:e}){this.kisaErrorMessage=e||this.$t("global_error_message")}this.isPending=!1}}},v=(n(2712),n(0)),component=Object(v.a)(f,(function(){var e=this,t=e._self._c;return e.isModalOpen?t("Modal",{attrs:{"trigger-element":e.modalTrigger,type:e.$modalTypes.SIDE_PANEL,"modal-class":"lv-newsletter-side-panel"},on:{closed:e.closeModal},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(e._s(e.$t("footer_newsletter")))]},proxy:!0},{key:"default",fn:function(){return[e.hasKisaPreferences&&!e.isKisaConfirmed?t("KisaContainer",{attrs:{"is-pending":e.isPending,"error-message":e.kisaErrorMessage},on:{submit:e.submitKisa,cancel:e.closeModal}}):e.hasSchema?t("NewsletterForm",{attrs:{schema:e.schemaSubscribe,"is-open-qubit-modal":e.isOpenQubitModal},on:{"close-modal":e.closeModal}}):e._e()]},proxy:!0}],null,!1,910469826)}):e._e()}),[],!1,null,null,null);t.default=component.exports},1129:function(e,t,n){"use strict";var r,o,l;n.d(t,"d",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return l})),n.d(t,"a",(function(){return c})),function(e){e.NewsletterPersonalDataConsent="newsletterPersonalDataConsent",e.StoreAppointmentPersonalDataConsent="storeAppointmentPersonalDataConsent",e.LvTermsAndUseConsent="lvTermsAndUseConsent",e.MainPersonalDataConsent="mainPersonalDataConsent",e.AdditionalPersonalDataConsent="additionalPersonalDataConsent",e.ThirdPartiesPersonalDataConsent="thirdPartiesPersonalDataConsent",e.PromotionPersonalDataConsent="promotionPersonalDataConsent",e.RequiredAgeConsent="requiredAgeConsent"}(r||(r={})),function(e){e.MarketingEmail="marketing_email",e.MarketingSms="marketing_sms",e.Phone="phone",e.PersonalSms="personal_sms",e.Postal="postal",e.PartnerEmail="personal_consent"}(o||(o={})),function(e){e.MarketingEmailPrimary="isOptinToReceiveNewsletterEmails",e.MarketingEmailSecondary="isOptinToReceiveEmails",e.MarketingSms="isOptinToReceiveMarketingSms",e.Phone="isOptinToReceiveCalls",e.Sms="isOptinToReceiveSms",e.Postal="isOptinToReceiveMails",e.PartnerEmail="isOptinToReceivePartnerEmails"}(l||(l={}));const c=[{id:o.MarketingEmail,keys:[l.MarketingEmailPrimary,l.MarketingEmailSecondary]},{id:o.MarketingSms,key:l.MarketingSms},{id:o.Phone,key:l.Phone},{id:o.PersonalSms,key:l.Sms},{id:o.Postal,key:l.Postal},{id:o.PartnerEmail,key:l.PartnerEmail}]},1134:function(e,t,n){"use strict";n.d(t,"a",(function(){return _})),n.d(t,"b",(function(){return f}));var r=n(1),o=n(119),l=n.n(o),c=n(373),m=n(173),d=n(1129);const h=1e3;var _;function f(){const e=Object(m.a)(),t=Object(c.a)(),n=Object(r.ref)({}),o=Object(r.ref)({}),_=Object(r.ref)("");const f=l()((async()=>{if(!Object.keys(o.value).length)return n.value;const e={...o.value};o.value={};const r={...n.value};try{return await t.account.updateConsents(e),_.value="",n.value}catch(e){return n.value=r,v(e),_.value}}),h);function v(t){const{serviceErrMessage:n}=t;_.value=n||e.t("global_error_message").toString()}const w=Object(r.ref)([]),k={checkout:[d.d.LvTermsAndUseConsent,d.d.MainPersonalDataConsent,d.d.ThirdPartiesPersonalDataConsent,d.d.PromotionPersonalDataConsent,d.d.RequiredAgeConsent],appointments:[d.d.StoreAppointmentPersonalDataConsent],newsletter:[d.d.NewsletterPersonalDataConsent]};const y=Object(r.computed)((()=>e=>k[e].every((e=>{const t=w.value.find((t=>t.type===e));return null==t?void 0:t.value})))),C=Object(r.ref)(!1);return{consents:n,getConsents:async function(){try{return n.value=await t.account.getConsents(),n.value}catch(e){return v(e),_.value}},updateConsents:function(e){return n.value={...n.value,...e},o.value={...o.value,...e},f()},consentsErrorMessage:_,koreaConsents:w,getKoreaConsents:async function(){w.value=await t.account.getKoreaConsents()||[]},updateKoreaConsents:async function(e){const n=function(e){return w.value.map((t=>k[e].includes(t.type)?{type:t.type,value:!0}:t))}(e);await t.account.updateKoreaConsents(n)},hasAlreadyKoreaConsent:y,handleSmsConsentPhoneWarning:function(e){const{isOptinToReceiveMarketingSms:t,phone:n}=e,r=null==n?void 0:n.phoneNumber;C.value=!!t&&!r},showEmptyPhoneWarning:C}}!function(e){e.Checkout="checkout",e.Appointments="appointments",e.Newsletter="newsletter"}(_||(_={}))},1402:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(11);function o(){const{sendTrackingData:e}=Object(r.a)();function t(t){e({...t,labelGa:"phone_number_not_filled",marketing_channel_type:"marketing_sms:1"})}function n(e,t){const n=e.querySelector(t);n&&n.focus()}return{trackSmsConsent:t,handlePhoneWarningFocus:n,trackSmsConsentWithFocus:function(e,r,o){t(e),n(r,o)}}}},1403:function(e,t,n){"use strict";function r(e){let{countryIsoCode:t,property:n,childProperty:r,schema:o}=e;var l,c,m;if(!t)return"";const d=null===(m=null===(c=null===(l=null==o?void 0:o.properties)||void 0===l?void 0:l[n])||void 0===c?void 0:c.properties)||void 0===m?void 0:m[r];if(!d||!Array.isArray(d.enum)||!Array.isArray(d.enumName))return"";const h=d.enum.indexOf(t);return h>-1?d.enumName[h]:""}n.d(t,"a",(function(){return r}))},1404:function(e,t,n){var content=n(1628);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(10).default)("7bdf593d",content,!0,{sourceMap:!1})},1627:function(e,t,n){"use strict";n(1404)},1628:function(e,t,n){var r=n(9)((function(i){return i[1]}));r.push([e.i,".lv-newsletter-form__form #mobileNo-field{display:none;visibility:hidden}[dir=ltr] .lv-newsletter-form__form #emailConsent-field,[dir=ltr] .lv-newsletter-form__form #isOptinToReceiveMarketingSms-field{margin:0 0 0 1.5rem}[dir=rtl] .lv-newsletter-form__form #emailConsent-field,[dir=rtl] .lv-newsletter-form__form #isOptinToReceiveMarketingSms-field{margin:0 1.5rem 0 0}[dir=ltr] .lv-newsletter-form__additional-info-legal-text{margin:0 0 0 2rem}[dir=rtl] .lv-newsletter-form__additional-info-legal-text{margin:0 2rem 0 0}[dir] .lv-newsletter-form__success-block{background-color:#fff}[dir] .lv-newsletter-form__success-block-text{margin-bottom:2.5rem}.lv-newsletter-form__success-block-text:focus{outline:0}.keyboard-is-used .lv-newsletter-form__success-block-text:focus{outline:2px solid;outline-offset:var(--focus-outline-offset)}.lv-newsletter-form__success-block-buttons{display:flex;flex-wrap:wrap;gap:1rem;justify-content:flex-end}[dir] .lv-newsletter-form__success-block-buttons{padding:2.5rem 0}.lv-newsletter-form__success-block-buttons .lv-button{width:100%}@media screen and (min-width:48rem){.lv-newsletter-form__success-block-buttons .lv-button{width:auto}}[dir] .lv-newsletter-form.-is-mylv .lv-newsletter-form__form .lv-form-container__fields{padding:1.5rem 2rem}[dir] .lv-newsletter-form.-is-mylv .lv-newsletter-form__success-block{padding:3rem}",""]),r.locals={},e.exports=r},1781:function(e,t,n){"use strict";n(2);var r,o=n(86);!function(e){e.Subscribe="subscribe",e.Unsubscribe="unsubscribe"}(r||(r={}));var l=n(8),c=n(4),m=n(321),d=n(172),h=n(19),_=n(69),f=n(5),v=n(387),w=n(1403),k=n(237),y=n(11),C=n(1134),S=n(1402),P={components:{FormContainer:d.default,SmartLink:h.default,LegalNoticeSection:()=>n.e(8).then(n.bind(null,1537))},props:{schema:{type:Object,default:()=>({})},type:{type:String,default:"subscribe"},context:{type:String,default:"footer"},isOpenQubitModal:{type:Boolean,default:!1}},setup(){const{isEnabled:e}=Object(k.a)(),{sendTrackingData:t}=Object(y.a)(),{handleSmsConsentPhoneWarning:n,showEmptyPhoneWarning:r}=Object(C.b)(),{trackSmsConsentWithFocus:o}=Object(S.a)();return{smsConsentEnabled:e("smsConsentEnabled"),sendTrackingData:t,handleSmsConsentPhoneWarning:n,showEmptyPhoneWarning:r,trackSmsConsentWithFocus:o}},data(){var e;return{isPending:!1,clientData:[],isSubscribeSuccessful:!1,isUnsubscribeSuccessful:!1,serviceErrors:{},errorMessage:null,registrationUrl:"",informations:{categoryGa:"form_newsletter",actionPosition:"bottom_page"},showMarketingConsent:(null===(e=this.schema)||void 0===e||null===(e=e.properties)||void 0===e||null===(e=e.marketingConsent)||void 0===e?void 0:e.default)||!1}},computed:{hasForm(){return!this.isSubscribeSuccessful&&!this.isUnsubscribeSuccessful},isMyLVContext(){return"mylv"===this.context},isFooterContext(){return"footer"===this.context},homepageUrl(){return this.localePath(l.b.Homepage)},isTwist(){return this.$store.getters[c.LOCALE_CONTEXT_IS_TWIST]},isChina(){return this.$store.getters[c.LOCALE_CONTEXT_IS_CHINA]},formattedClientName(){return this.clientData.length>0?"".concat(this.clientData[0].firstName," ").concat(this.clientData[0].lastName):""}},watch:{showEmptyPhoneWarning(e){if(e){const e={categoryGa:"form_newsletter"},t=this.$refs.newsletterForm.$el,n="#newsletter-form-phone-phoneNumber";this.trackSmsConsentWithFocus(e,t,n)}}},mounted(){this.$watch((()=>{var e;return null===(e=this.$refs.newsletterForm)||void 0===e||null===(e=e.model)||void 0===e?void 0:e.marketingConsent}),this.onMarketingConsentChange,{deep:!0}),this.$watch((()=>{var e,t;return[null===(e=this.$refs.newsletterForm)||void 0===e||null===(e=e.model)||void 0===e?void 0:e.emailConsent,null===(t=this.$refs.newsletterForm)||void 0===t||null===(t=t.model)||void 0===t?void 0:t.isOptinToReceiveMarketingSms]}),this.onEmailSmsConsentToggle,{deep:!0}),this.$watch((()=>{var e;return null===(e=this.$refs.newsletterForm)||void 0===e?void 0:e.model}),(e=>{e&&this.handleSmsConsentPhoneWarning(e)}),{deep:!0}),this.isChina&&(this.registrationUrl=Object(f.f)({locale:this.$store.state.localeContext.locale,legacyUrl:this.$config.legacy_secure_domain_cn}))},methods:{onMarketingConsentChange(e){this.showMarketingConsent=!!e,e&&(this.$refs.newsletterForm.model.emailConsent=!0)},onEmailSmsConsentToggle(e){let[t,n]=e;!1===t&&!1===n&&(this.$refs.newsletterForm.model.marketingConsent=!1)},setPhonePayload(e){const t=e.phone;t&&(e.phoneNumberTelCode=Object(w.a)({countryIsoCode:t.phoneNumberCountry,property:"phone",childProperty:"phoneNumberCountry",schema:this.schema}),e.phoneNumber=t.phoneNumber,delete e.phone)},async handleNewsletterSubmission(){this.resetSubmissionFlags(),this.isPending=!0;const e={...this.$refs.newsletterForm.model};if(this.isChina||this.setEmailTracking(e.email),this.setPhonePayload(e),this.type===r.Subscribe)if(this.isOpenQubitModal?this.sendTrackingOnNewsletterSubmission("qubit_popup_subscribe_intention","qubit_popup_subscribe_intention"):this.sendTrackingOnNewsletterSubmission("subscribe_intention","subscribe_intention",e),e.email===e.emailConfirmation)try{if(Object.assign(e,{status:"active"}),await this.$domain.account.guestNewsletterSubscription(e),this.sendTrackingOnNewsletterSubmission("subscription_success","newsletter_subscription_succeeded",e),this.clientData.push(e),this.isPending=!1,this.isSubscribeSuccessful=!0,this.$emit("update:isSubscribeSuccessful",this.isSubscribeSuccessful),this.isTwist&&!this.isFooterContext){const e="".concat(window.location.origin).concat(this.$route.fullPath);this.registrationUrl=await Object(_.a)(this,e,o.c.Registration)}await this.$nextTick(),this.$refs.successText.focus(),this.isFooterContext||window.scrollTo(0,0)}catch(t){this.handleErrors(t),this.sendTrackingOnNewsletterSubmission("subscription_failure","newsletter_subscription_failed",e)}else this.handleErrors({emailConfirmation:this.$t("lib_error_email_confirmation")},!0),this.sendTrackingOnNewsletterSubmission("subscription_failure","newsletter_subscription_failed",e);if(this.type===r.Unsubscribe)try{await this.$domain.account.guestNewsletterUnsubscription(e.emailUnsubscribe),this.sendTrackingOnNewsletterSubmission("unsubscribe","unsubscribe"),this.isPending=!1,this.isUnsubscribeSuccessful=!0,this.$emit("update:isUnsubscribeSuccessful",this.isUnsubscribeSuccessful)}catch(e){this.handleErrors(e),this.sendTrackingOnNewsletterSubmission("unsubscription_failure","newsletter_unsubscription_failed")}},resetSubmissionFlags(){this.isUnsubscribeSuccessful=!1,this.isSubscribeSuccessful=!1},handleErrors(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;this.serviceErrors=t?e:Object(m.f)(e.serviceErrors),this.errorMessage=t?null:this.$t("global_error_message")||e.message,this.isPending=!1},getMarketingChannelValue(e){let t="marketing_email:1";if(this.schema&&this.schema.properties.isOptinToReceiveMarketingSms){const n=e.isOptinToReceiveMarketingSms?"1":"0";t="marketing_email:1|marketing_sms:".concat(n)}return t},sendTrackingOnNewsletterSubmission(e,t,n){const r={actionGa:e,actionId:t,...this.informations,marketing_channel_type:this.getMarketingChannelValue(n)};this.sendTrackingData(r)},trackingAccountCreation(){return this.sendTrackingData({categoryGa:"form_newsletter",actionGa:"create_my_account"})},trackingBackToHome(){return this.sendTrackingData({categoryGa:"form_newsletter",actionGa:"back_to_home"})},setEmailTracking(e){this.sendTrackingData({mkey:Object(v.b)(e),actionGa:"mkey_submitted",actionId:"mkey_submitted",categoryGa:"mkey_submitted"})}}},T=P,M=(n(1627),n(0)),component=Object(M.a)(T,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"lv-newsletter-form",class:{"-is-mylv":e.isMyLVContext}},[e.hasForm?t("section",[e.isFooterContext?t("p",[e._v(e._s(e.$t("mylv_newsletter_registration_title")))]):e._e(),e._v(" "),t("FormContainer",{ref:"newsletterForm",staticClass:"lv-newsletter-form__form",attrs:{id:"newsletter-form","form-schema":e.schema,"service-errors":e.serviceErrors,"error-message":e.errorMessage,"is-pending":e.isPending},on:{submit:e.handleNewsletterSubmission},scopedSlots:e._u([e.showMarketingConsent?{key:"field-content-before-emailConsent",fn:function(){return[t("p",{staticClass:"body-s"},[e._v(e._s(e.$t("newsletter_channel_preferences")))])]},proxy:!0}:null,e.showEmptyPhoneWarning?{key:"field-content-after-phone",fn:function(){return[t("span",{staticClass:"body-s -text-is-grey"},[e._v(e._s(e.$t("mylv_consent_phone_not_filled")))])]},proxy:!0}:null,{key:"field-content-after-isOptinToReceiveMarketingSms",fn:function(){return[e.showMarketingConsent?t("p",{directives:[{name:"safe-html",rawName:"v-safe-html",value:e.$t("preferences_center_channel_marketing_sms_helptext"),expression:"$t('preferences_center_channel_marketing_sms_helptext')"}],staticClass:"lv-newsletter-form__additional-info-legal-text body-s -text-is-grey"}):e._e()]},proxy:!0}],null,!0)})],1):e._e(),e._v(" "),e.isSubscribeSuccessful?t("section",[t("div",{staticClass:"lv-newsletter-form__success-block"},[t("p",{ref:"successText",staticClass:"lv-newsletter-form__success-block-text body-l",attrs:{tabindex:"0"}},[e._v("\n        "+e._s(e.formattedClientName)+" "),t("br"),e._v("\n        "+e._s(e.$t("mylv_newsletter_registration_confirmation"))),t("br"),t("br"),e._v("\n        "+e._s(e.$t("global_thanksmessage"))+"\n      ")]),e._v(" "),e.isMyLVContext?t("span",{staticClass:"body-s"},[e._v(e._s(e.$t("mylv_newsletter_subscription_success_message_desc")))]):e._e()]),e._v(" "),e.isMyLVContext?t("div",{staticClass:"lv-newsletter-form__success-block-buttons"},[t("SmartLink",{directives:[{name:"tracking",rawName:"v-tracking",value:e.trackingBackToHome(),expression:"trackingBackToHome()"}],staticClass:"lv-newsletter-form__button-back-home lv-button -secondary",attrs:{url:e.homepageUrl}},[e._v("\n        "+e._s(e.$t("global_go_to_homepage"))+"\n      ")]),e._v(" "),t("SmartLink",{directives:[{name:"tracking",rawName:"v-tracking",value:e.trackingAccountCreation(),expression:"trackingAccountCreation()"}],staticClass:"lv-newsletter-form__button-registration lv-button -primary",attrs:{url:e.registrationUrl}},[e._v("\n        "+e._s(e.$t("global_create_mylv_account"))+"\n      ")])],1):e._e()]):e._e(),e._v(" "),e.isUnsubscribeSuccessful?t("section",[t("p",[e._v(e._s(e.$t("mylv_newsletter_unsubscription_confirmation")))]),e._v(" "),t("SmartLink",{directives:[{name:"tracking",rawName:"v-tracking",value:e.trackingBackToHome(),expression:"trackingBackToHome()"}],staticClass:"lv-newsletter-form__button-back-home lv-button -primary",attrs:{url:e.homepageUrl}},[e._v("\n      "+e._s(e.$t("global_go_to_homepage"))+"\n    ")])],1):e._e(),e._v(" "),t("LegalNoticeSection")],1)}),[],!1,null,null,null);t.a=component.exports},2021:function(e,t,n){var content=n(2713);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(10).default)("5df09b28",content,!0,{sourceMap:!1})},2712:function(e,t,n){"use strict";n(2021)},2713:function(e,t,n){var r=n(9)((function(i){return i[1]}));r.push([e.i,"[dir=ltr] .lv-newsletter-side-panel.lv-modal.-sidepanel .lv-modal__title{padding-left:6.4vw}[dir=rtl] .lv-newsletter-side-panel.lv-modal.-sidepanel .lv-modal__title{padding-right:6.4vw}[dir] .lv-newsletter-side-panel.lv-modal.-sidepanel .lv-modal__content{padding-left:6.4vw;padding-right:6.4vw}[dir] .lv-newsletter-side-panel .lv-form-container__fields{padding-bottom:1.5rem}",""]),r.locals={},e.exports=r}}]);
//# sourceMappingURL=44639-8f0b8.js.map